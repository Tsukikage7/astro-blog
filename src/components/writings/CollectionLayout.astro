---
import BaseLayout from "@components/base/BaseLayout.astro";
import WritingsListCard from "@components/writings/WritingsListCard.astro";
import Pagination from "@components/common/Pagination.astro";
import PageHeader from "@components/common/PageHeader.astro";
import LiquidGlassLess from "@components/common/LiquidGlassLess.astro";
import type { WritingsEntry } from "@/types";

interface Props {
  entryIndex?: WritingsEntry;
  entries: WritingsEntry[];
  tags?: string[];
  pageIndex: number;
  pageCount: number;
  allCount?: number;
  basePath?: string;
  currentTag?: string;
}

const {
  entryIndex,
  entries,
  tags = [],
  pageIndex,
  pageCount,
  allCount,
  basePath,
  currentTag,
} = Astro.props;

const { title, description } = entryIndex?.data || {
  title: "文字小筑",
  description: "记录灵感与故事的角落",
};
---

<BaseLayout title={title} description={description}>
  <div class="container px-3 lg:px-8">
    <PageHeader
      title={title}
      description={description}
      articleCount={allCount}
    />

    <section class="">
      <div class="flex flex-col lg:flex-row gap-6">
        <!-- 主内容区 -->
        <div class="flex-1">
          {entries.length === 0 ? (
            <LiquidGlassLess
              heavy
              wrapperClass="dock rounded-lg p-8 text-center"
            >
              <p class="text-txt-light dark:text-darkmode-txt-light text-lg">
                暂无作品，敬请期待...
              </p>
            </LiquidGlassLess>
          ) : (
            entries.map((entry, index) => (
              <div class="mb-4" style={`animation-delay: ${index * 100}ms`}>
                <WritingsListCard entry={entry} />
              </div>
            ))
          )}

          {pageCount > 1 && (
            <Pagination
              collection="writings"
              pageIndex={pageIndex}
              pageCount={pageCount}
              basePath={basePath}
            />
          )}
        </div>

        <!-- 侧边栏 -->
        <div class="lg:w-64 lg:sticky lg:top-[4.5rem] lg:self-start space-y-4">
          {tags.length > 0 && (
            <LiquidGlassLess
              heavy
              wrapperClass="dock rounded-lg p-4"
            >
              <h3 class="text-base font-medium text-foreground mb-3">
                标签
              </h3>
              <div class="flex flex-wrap gap-2">
                <a
                  href="/writings"
                  class={`inline-flex items-center px-2.5 py-1 rounded-md text-sm transition-colors ${
                    !currentTag
                      ? "bg-foreground text-background"
                      : "bg-muted/60 text-muted-foreground hover:bg-muted hover:text-foreground"
                  }`}
                >
                  全部
                </a>
                {tags.map((tag) => (
                  <a
                    href={`/writings/tags/${encodeURIComponent(tag)}`}
                    class={`inline-flex items-center px-2.5 py-1 rounded-md text-sm transition-colors ${
                      currentTag === tag
                        ? "bg-foreground text-background"
                        : "bg-muted/60 text-muted-foreground hover:bg-muted hover:text-foreground"
                    }`}
                  >
                    {tag}
                  </a>
                ))}
              </div>
            </LiquidGlassLess>
          )}

          <LiquidGlassLess
            heavy
            wrapperClass="dock rounded-lg p-4"
          >
            <h3 class="text-base font-medium text-foreground mb-3">
              关于这里
            </h3>
            <p class="text-sm text-muted-foreground leading-relaxed">
              这里是我的文学创作空间，收录短篇小说、散文随笔和偶尔的诗歌。文字是思想的载体，故事是灵魂的倒影。
            </p>
          </LiquidGlassLess>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>
