---

import { FaRegEye } from "react-icons/fa";

const { slug, className = "" } = Astro.props as {
  slug: string;
  className?: string;
};
---

<span
  id="busuanzi_container_page_pv"
  class={`inline-flex items-center gap-1 ${className}`}
  style="display:none"
>
  <FaRegEye className="text-base" />
  <span id="busuanzi_value_page_pv" class="tabular-nums">--</span>
  <span>次阅读</span>
</span>

<script>
  
  function loadBusuanzi() {
    
    if (window.busuanzi) {
      
      showContainer();
      return;
    }

    
    const script = document.createElement("script");
    script.async = true;
    script.src = "https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js";

    script.onload = () => {
      console.log("不蒜子统计加载成功");
      showContainer();
    };

    script.onerror = () => {
      console.error("不蒜子统计加载失败");
      
      const container = document.getElementById("busuanzi_container_page_pv");
      if (container) {
        container.style.display = "none";
      }
    };

    document.body.appendChild(script);
  }

  function showContainer() {
    
    setTimeout(() => {
      const container = document.getElementById("busuanzi_container_page_pv");
      const value = document.getElementById("busuanzi_value_page_pv");

      if (container && value && value.textContent !== "--") {
        container.style.display = "inline-flex";
      } else if (container && value) {
        
        setTimeout(showContainer, 500);
      }
    }, 100);
  }

  
  document.addEventListener("DOMContentLoaded", loadBusuanzi);
  document.addEventListener("astro:page-load", loadBusuanzi);
</script>
