---
import type { CollectionEntry } from "astro:content";
import { plainify, slugify } from "@lib/textConverter";
import { FaRegCalendarAlt, FaMapMarkerAlt, FaSmile, FaRegCommentDots } from "react-icons/fa";
import { formatDate } from "@lib/formatDate";

interface Props {
  entries: CollectionEntry<"notes">[];
  limit?: number;
}

const { entries, limit = 3 } = Astro.props;
const displayEntries = entries.slice(0, limit);
---

<div class="pt-3">
  <h3 class="text-lg font-medium text-foreground mb-6 flex items-center gap-2">
    <svg class="w-5 h-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
    </svg>
    动态
  </h3>

  <div class="space-y-1">
    {
      displayEntries.map((entry, index) => {
        const { title, description, date, mood, location } = entry.data;
        const entryDate = date ? formatDate(date) : null;
        
        const contentPreview = entry.body
          ? plainify(entry.body).slice(0, 100) +
            (plainify(entry.body).length > 100 ? "..." : "")
          : "";

        return (
          <div
            class="group rounded-lg hover:bg-muted transition-all duration-300 intersect:animate-fadeUp opacity-0 py-2 px-4"
            style={`animation-delay: ${index * 200}ms`}
          >
            <div class="flex items-start space-x-2">
              {}
              {}
              <a
                href={`/notes/${slugify(entry.data.title)}`}
                class="hover:text-primary transition-colors duration-0"
              >
                <div class="flex-1 min-w-0">
                  <span class="font-normal text-txt-p dark:text-darkmode-txt-p mb-1 line-clamp-1">
                    {title}
                  </span>
                  { 
                  }

                  {}
                  <div class="flex flex-wrap items-center gap-2 mb-1">
                    {entryDate && (
                      <time class="text-xs text-txt-light dark:text-darkmode-txt-light opacity-70 flex items-center">
                        <FaRegCalendarAlt className="mr-1 text-[10px]" />
                        {entryDate}
                      </time>
                    )}

                    {mood && (
                      <span class="text-xs text-txt-light dark:text-darkmode-txt-light opacity-70 flex items-center">
                        <FaSmile className="mr-1 text-[10px]" />
                        {mood}
                      </span>
                    )}

                    {location && (
                      <span class="text-xs text-txt-light dark:text-darkmode-txt-light opacity-70 flex items-center">
                        <FaMapMarkerAlt className="mr-1 text-[10px]" />
                        {location}
                      </span>
                    )}
                  </div>
                </div>
              </a>
            </div>
          </div>
        );
      })
    }
  </div>

  {}
  <div class="mt-4 text-center">
    <a
      href="/notes"
      class="text-sm text-primary hover:text-primary-dark transition-colors inline-flex items-center"
    >
      查看更多动态
      <svg
        class="ml-1 w-3 h-3 transition-transform duration-200 group-hover:translate-x-1"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"></path>
      </svg>
    </a>
  </div>
</div>
