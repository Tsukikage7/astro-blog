---
import type { CollectionEntry } from "astro:content";
import { plainify } from "@lib/textConverter";
import { FaRegCalendarAlt, FaMapMarkerAlt, FaSmile } from "react-icons/fa";
import { formatDate } from "@lib/formatDate";
import { Image } from "astro:assets";
import { SITE_INFO } from "@lib/config";
import LiquidGlass from "@components/common/LiquidGlassLess.astro";
import { slugify } from "@lib/textConverter";

interface Props {
  entry: CollectionEntry<"notes">;
}

const { entry }: Props = Astro.props;
const { title, description, date, tags, images, mood, location } =
  entry.data;

const slug = slugify(entry.data.title);
const entryDate = date ? formatDate(date) : null;

const contentPreview = entry.body
  ? plainify(entry.body).slice(0, 150) +
    (plainify(entry.body).length > 150 ? "..." : "")
  : "";

---

<LiquidGlass
  heavy
  wrapperClass="dock rounded-lg my-4 pl-0 bg-gradient-to-br gradient shadow-lg hover:shadow-xl hover:scale-[1.01]"
  textClass="h-full"
  animation="fadeRight"
>
  <div class="p-4">
    
    <div class="flex items-center mb-4">
      <div
        class="w-10 h-10 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700"
      >
        <img
          src={SITE_INFO.AUTHOR_AVATAR}
          alt="作者头像"
          class="w-full h-full object-cover"
        />
      </div>
      <div class="ml-3">
        <h4 class="font-bold">Tsukikage</h4>
        <div class="flex items-center text-xs text-gray-700 dark:text-gray-400">
          {
            entryDate && (
              <span class="flex items-center">
                <FaRegCalendarAlt className="mr-1" />
                {entryDate}
              </span>
            )
          }
          {
            location && (
              <span class="flex items-center ml-2">
                <FaMapMarkerAlt className="mr-1" />
                {location}
              </span>
            )
          }
          {
            mood && (
              <span class="flex items-center ml-2">
                <FaSmile className="mr-1" />
                {mood}
              </span>
            )
          }
        </div>
      </div>
    </div>

    
    <div class="mb-4">
      
      <h3
        class="mb-2 text-xl font-bold text-txt-p dark:text-darkmode-txt-p leading-tight"
      >
        <a
          href={`/notes/${slug}`}
          class="hover:text-primary transition-colors duration-200"
        >
          {title}
        </a>
      </h3>

      
      <a href={`/notes/${slug}`} class="block">
        <p class="text-gray-700 dark:text-gray-300 leading-relaxed mb-3">
          {description || contentPreview}
        </p>
      </a>

      
      {
        images && images.length > 0 && (
          <div class="relative flex flex-wrap gap-4 rounded-lg mb-3">
            {images.map((image) => (
              <a href={`/notes/${slug}`} class="block">
                <Image
                  class="w-full h-full rounded-md md:rounded-lg shadow-lg object-cover max-w-[100px] md:max-w-[200px] max-h-[100px] md:max-h-[200px] hover:scale-105 transition-transform duration-500"
                  src={image.src}
                  alt={image.alt}
                  width={300}
                  height={300}
                  quality={90}
                  format="webp"
                  loading="lazy"
                />
              </a>
            ))}
          </div>
        )
      }


      {
        tags && tags.length > 0 && (
          <div class="flex flex-wrap gap-1.5">
            {tags.map((tag) => (
              <a
                href={`/notes/tags/${tag}`}
                class="inline-flex items-center px-2 py-0.5 rounded text-[11px] font-medium
                       bg-muted/80 dark:bg-muted/60
                       text-muted-foreground dark:text-muted-foreground
                       hover:bg-muted dark:hover:bg-muted/80
                       transition-colors duration-200"
              >
                <span class="mr-0.5 opacity-60">#</span>
                {tag}
              </a>
            ))}
          </div>
        )
      }
    </div>
  </div>
</LiquidGlass>
